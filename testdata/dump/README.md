# Test Data

This directory contains sample database schemas for testing and validation of the pgschema tool.

## Test Schemas Overview

- **employee**: Simple HR database with employees, departments, and salary history (MIT licensed)
- **sakila**: DVD rental store database with complex relationships and business logic  
- **bytebase**: Database schema management tool's own schema
- **tenant**: Multi-tenant SaaS application schema referencing public schema

## Directory Structure

Each subfolder contains a complete schema test case with the following files:

- `manifest.json` - Test metadata including name, source, and license information
- `raw.sql` - Original DDL statements used to create the schema (when available)
- `pgdump.sql` - Reference output generated by PostgreSQL's `pg_dump` tool (when available)
- `pgschema.sql` - Output generated by `pgschema dump`
- `public.sql` - Additional schema files for multi-schema test cases (tenant only)

## Generating Reference Output

The `pgdump.sql` files are generated using PostgreSQL's `pg_dump` tool with the following command:

```bash
export PGPASSWORD='testpwd1'
pg_dump \
  --schema-only \
  --no-owner \
  --no-privileges \
  --no-tablespaces \
  --disable-triggers \
  --host=localhost \
  --port=5432 \
  --username=postgres \
  <<database>> > pgdump.sql
```

The `pgschema.sql` files are generated by running:

```bash
export PGPASSWORD='testpwd1'
pgschema dump --host localhost --port 5432 --user postgres --db <<database>> --schema <<schema>>
```

## Usage in Tests

These test cases are used by various integration tests throughout the codebase:

### Dump Command Tests (`cmd/dump/dump_integration_test.go`)

The test data validates the `pgschema dump` command functionality:

- **Employee** - Tests basic schema dumping with tables, views, and functions (has `raw.sql`)
- **Sakila** - Tests complex schema with enum types, constraints, and triggers (missing `raw.sql`)  
- **Bytebase** - Tests enterprise-level schema with various PostgreSQL features (has `raw.sql`)
- **Tenant** - Tests multi-schema scenarios with cross-schema references (has `public.sql`)

Each test:

1. Creates a PostgreSQL container using testcontainers
2. Loads the schema into the database (from `pgdump.sql` or `raw.sql`)
3. Runs `pgschema dump` command with appropriate `--schema` flag
4. Compares the output against the expected `pgschema.sql` file

### Multi-File Dump Tests (`cmd/dump/multifile_test.go`)

Tests the `--multi-file` functionality that outputs schema objects to separate files organized by type.
