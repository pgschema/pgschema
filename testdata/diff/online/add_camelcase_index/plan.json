{
  "can_run_in_transaction": false,
  "has_unsafe_operations": false,
  "rewrite_steps": [
    {
      "sql": "CREATE INDEX CONCURRENTLY IF NOT EXISTS \"idx_invite_assignedTo\" ON invite (\"assignedTo\");",
      "can_run_in_transaction": false
    },
    {
      "sql": "SELECT \n    COALESCE(i.indisvalid, false) as done,\n    CASE \n        WHEN p.blocks_total > 0 THEN p.blocks_done * 100 / p.blocks_total\n        ELSE 0\n    END as progress\nFROM pg_class c\nLEFT JOIN pg_index i ON c.oid = i.indexrelid\nLEFT JOIN pg_stat_progress_create_index p ON c.oid = p.index_relid\nWHERE lower(c.relname) = lower('idx_invite_assignedTo');",
      "can_run_in_transaction": true,
      "directive": {
        "type": "wait",
        "properties": {
          "query": "SELECT \n    COALESCE(i.indisvalid, false) as done,\n    CASE \n        WHEN p.blocks_total > 0 THEN p.blocks_done * 100 / p.blocks_total\n        ELSE 0\n    END as progress\nFROM pg_class c\nLEFT JOIN pg_index i ON c.oid = i.indexrelid\nLEFT JOIN pg_stat_progress_create_index p ON c.oid = p.index_relid\nWHERE lower(c.relname) = lower('idx_invite_assignedTo');",
          "message": "Creating index idx_invite_assignedTo"
        }
      }
    },
    {
      "sql": "CREATE INDEX CONCURRENTLY IF NOT EXISTS idx_invite_created_invited ON invite (\"createdAt\", \"invitedBy\");",
      "can_run_in_transaction": false
    },
    {
      "sql": "SELECT \n    COALESCE(i.indisvalid, false) as done,\n    CASE \n        WHEN p.blocks_total > 0 THEN p.blocks_done * 100 / p.blocks_total\n        ELSE 0\n    END as progress\nFROM pg_class c\nLEFT JOIN pg_index i ON c.oid = i.indexrelid\nLEFT JOIN pg_stat_progress_create_index p ON c.oid = p.index_relid\nWHERE lower(c.relname) = lower('idx_invite_created_invited');",
      "can_run_in_transaction": true,
      "directive": {
        "type": "wait",
        "properties": {
          "query": "SELECT \n    COALESCE(i.indisvalid, false) as done,\n    CASE \n        WHEN p.blocks_total > 0 THEN p.blocks_done * 100 / p.blocks_total\n        ELSE 0\n    END as progress\nFROM pg_class c\nLEFT JOIN pg_index i ON c.oid = i.indexrelid\nLEFT JOIN pg_stat_progress_create_index p ON c.oid = p.index_relid\nWHERE lower(c.relname) = lower('idx_invite_created_invited');",
          "message": "Creating index idx_invite_created_invited"
        }
      }
    }
  ]
}
